{% extends 'base.html' %}
{% load static %}

{% block title %}{{ meal_plan.name }} - MealMate{% endblock %}

{% block content %}
<div class="container py-5">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="{% url 'home' %}">Home</a></li>
                    <li class="breadcrumb-item"><a href="{% url 'mealplans:mealplan_list' %}">Meal Plans</a></li>
                    <li class="breadcrumb-item active">{{ meal_plan.name }}</li>
                </ol>
            </nav>
            <h1 class="display-4">{{ meal_plan.name }}</h1>
            <p class="lead">
                <i class="fas fa-calendar me-2"></i>
                {{ meal_plan.start_date|date:"M d" }} - {{ meal_plan.end_date|date:"M d, Y" }}
                {% if meal_plan.is_current %}
                <span class="badge bg-success ms-2">Current Week</span>
                {% endif %}
            </p>
            {% if meal_plan.description %}
            <p class="text-muted">{{ meal_plan.description }}</p>
            {% endif %}
        </div>
        <div class="col-md-4 text-md-end">
            <div class="btn-group" role="group">
                <a href="{% url 'mealplans:mealplan_update' meal_plan.pk %}" class="btn btn-warning">
                    <i class="fas fa-edit"></i> Edit
                </a>
                <a href="{% url 'mealplans:mealplan_delete' meal_plan.pk %}" class="btn btn-danger">
                    <i class="fas fa-trash"></i> Delete
                </a>
            </div>
            <div class="mt-2">
                <a href="{% url 'shopping:generate_from_meal_plan' meal_plan.pk %}" class="btn btn-success btn-lg w-100">
                    <i class="fas fa-shopping-cart me-2"></i>Generate Shopping List
                </a>
            </div>
        </div>
    </div>

    <!-- Statistics -->
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0"><i class="fas fa-chart-bar me-2"></i>Week Statistics</h5>
        </div>
        <div class="card-body">
            <div class="row text-center">
                <div class="col-md-3">
                    <h3 class="text-primary">{{ meal_plan.meals.count }}</h3>
                    <p class="text-muted">Meals Planned</p>
                </div>
                <div class="col-md-3">
                    <h3 class="text-success">{{ meal_plan.meals.all|length }}</h3>
                    <p class="text-muted">Total Recipes</p>
                </div>
                <div class="col-md-3">
                    <h3 class="text-warning">
                        {% widthratio meal_plan.meals.count 28 100 %}%
                    </h3>
                    <p class="text-muted">Week Complete</p>
                </div>
                <div class="col-md-3">
                    <a href="{% url 'shopping:generate_from_meal_plan' meal_plan.pk %}" class="btn btn-success">
                        <i class="fas fa-list me-2"></i>Shopping List
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Weekly Meal Grid -->
    {% for day_num, day_data in meals_by_day.items %}
    <div class="card shadow-sm mb-4">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">
                <i class="fas fa-calendar-day me-2"></i>
                {{ day_data.day_name }} - {{ day_data.date|date:"M d, Y" }}
            </h4>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Breakfast -->
                <div class="col-md-3 mb-3">
                    <div class="border rounded p-3 h-100 {% if day_data.meals.breakfast %}bg-light{% endif %}">
                        <h6 class="text-muted mb-3">
                            <i class="fas fa-coffee me-2"></i>BREAKFAST
                        </h6>
                        {% if day_data.meals.breakfast %}
                        <div>
                            <h6>{{ day_data.meals.breakfast.recipe.title }}</h6>
                            <p class="small text-muted mb-2">
                                <i class="fas fa-fire me-1"></i>{{ day_data.meals.breakfast.recipe.calories }} cal
                            </p>
                            <a href="{% url 'recipes:recipe_detail' day_data.meals.breakfast.recipe.slug %}" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                            <a href="{% url 'mealplans:meal_delete' day_data.meals.breakfast.pk %}" 
                               class="btn btn-sm btn-outline-danger">
                                <i class="fas fa-times"></i>
                            </a>
                        </div>
                        {% else %}
                        <div class="text-center">
                            <p class="text-muted small">No meal planned</p>
                            <a href="{% url 'mealplans:meal_create' meal_plan.pk %}?day={{ day_num }}&type=breakfast" 
                               class="btn btn-sm btn-success">
                                <i class="fas fa-plus me-1"></i>Add
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Lunch -->
                <div class="col-md-3 mb-3">
                    <div class="border rounded p-3 h-100 {% if day_data.meals.lunch %}bg-light{% endif %}">
                        <h6 class="text-muted mb-3">
                            <i class="fas fa-hamburger me-2"></i>LUNCH
                        </h6>
                        {% if day_data.meals.lunch %}
                        <div>
                            <h6>{{ day_data.meals.lunch.recipe.title }}</h6>
                            <p class="small text-muted mb-2">
                                <i class="fas fa-fire me-1"></i>{{ day_data.meals.lunch.recipe.calories }} cal
                            </p>
                            <a href="{% url 'recipes:recipe_detail' day_data.meals.lunch.recipe.slug %}" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                            <a href="{% url 'mealplans:meal_delete' day_data.meals.lunch.pk %}" 
                               class="btn btn-sm btn-outline-danger">
                                <i class="fas fa-times"></i>
                            </a>
                        </div>
                        {% else %}
                        <div class="text-center">
                            <p class="text-muted small">No meal planned</p>
                            <a href="{% url 'mealplans:meal_create' meal_plan.pk %}?day={{ day_num }}&type=lunch" 
                               class="btn btn-sm btn-success">
                                <i class="fas fa-plus me-1"></i>Add
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Dinner -->
                <div class="col-md-3 mb-3">
                    <div class="border rounded p-3 h-100 {% if day_data.meals.dinner %}bg-light{% endif %}">
                        <h6 class="text-muted mb-3">
                            <i class="fas fa-utensils me-2"></i>DINNER
                        </h6>
                        {% if day_data.meals.dinner %}
                        <div>
                            <h6>{{ day_data.meals.dinner.recipe.title }}</h6>
                            <p class="small text-muted mb-2">
                                <i class="fas fa-fire me-1"></i>{{ day_data.meals.dinner.recipe.calories }} cal
                            </p>
                            <a href="{% url 'recipes:recipe_detail' day_data.meals.dinner.recipe.slug %}" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                            <a href="{% url 'mealplans:meal_delete' day_data.meals.dinner.pk %}" 
                               class="btn btn-sm btn-outline-danger">
                                <i class="fas fa-times"></i>
                            </a>
                        </div>
                        {% else %}
                        <div class="text-center">
                            <p class="text-muted small">No meal planned</p>
                            <a href="{% url 'mealplans:meal_create' meal_plan.pk %}?day={{ day_num }}&type=dinner" 
                               class="btn btn-sm btn-success">
                                <i class="fas fa-plus me-1"></i>Add
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Snack -->
                <div class="col-md-3 mb-3">
                    <div class="border rounded p-3 h-100 {% if day_data.meals.snack %}bg-light{% endif %}">
                        <h6 class="text-muted mb-3">
                            <i class="fas fa-cookie-bite me-2"></i>SNACK
                        </h6>
                        {% if day_data.meals.snack %}
                        <div>
                            <h6>{{ day_data.meals.snack.recipe.title }}</h6>
                            <p class="small text-muted mb-2">
                                <i class="fas fa-fire me-1"></i>{{ day_data.meals.snack.recipe.calories }} cal
                            </p>
                            <a href="{% url 'recipes:recipe_detail' day_data.meals.snack.recipe.slug %}" 
                               class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-eye me-1"></i>View
                            </a>
                            <a href="{% url 'mealplans:meal_delete' day_data.meals.snack.pk %}" 
                               class="btn btn-sm btn-outline-danger">
                                <i class="fas fa-times"></i>
                            </a>
                        </div>
                        {% else %}
                        <div class="text-center">
                            <p class="text-muted small">No meal planned</p>
                            <a href="{% url 'mealplans:meal_create' meal_plan.pk %}?day={{ day_num }}&type=snack" 
                               class="btn btn-sm btn-success">
                                <i class="fas fa-plus me-1"></i>Add
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endfor %}

</div>
{% endblock %}
